/*-- scss:rules --*/

// Fix for TOC sidebar positioning race condition
// Overrides JavaScript-set inline styles to prevent 105px vs 88px jumping

// Target the margin sidebar specifically
#quarto-margin-sidebar {
  // Override the JavaScript-set inline styles with !important
  // Use a stable calculated value based on typical navbar height
  top: 105px !important;
  max-height: calc(100vh - 105px) !important;
  
  // Ensure smooth transitions when position changes
  transition: top 0.2s ease-out, max-height 0.2s ease-out;
}

// Additional stability for the sidebar container
.sidebar.margin-sidebar {
  // Prevent jumping during content loading
  position: sticky !important;
  
  // Ensure the sidebar doesn't overlap with content during horizontal scroll
  z-index: 1000;
  
  // Prevent layout shifts
  min-width: 250px;
  max-width: 300px;
}

// Ensure TOC doesn't interfere with wide code blocks
@media (min-width: 992px) {
  // When there's horizontal scrolling in the main content
  .column-body {
    // Ensure proper spacing from the sidebar
    margin-right: 2rem;
    
    // Handle wide code blocks that might trigger horizontal scroll
    pre {
      max-width: calc(100vw - 350px); // Account for sidebar width
      overflow-x: auto;
    }
    
    // Prevent code blocks from overlapping sidebar
    .sourceCode {
      max-width: calc(100vw - 350px);
    }
  }
}

// Fallback for smaller screens where sidebar should be hidden anyway
@media (max-width: 991px) {
  #quarto-margin-sidebar {
    // Mobile handling is already good in styles-mobile.scss
    // This ensures the fix doesn't interfere with mobile layout
    position: relative !important;
    top: auto !important;
    max-height: none !important;
  }
}

// Additional fix for Headroom.js interaction
.headroom-target {
  // Prevent the headroom unpinned state from affecting our fixed positioning
  &.sidebar-unpinned {
    top: 105px !important;
    max-height: calc(100vh - 105px) !important;
  }
}

// Ensure smooth loading by preventing initial layout shifts
.sidebar.margin-sidebar.notransition {
  transition: none !important;
}